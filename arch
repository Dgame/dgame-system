ANSIBLE_PKG = ansible
PLAYBOOK = ansible-playbook
INVENTORY = -i hosts
FLAGS = --ask-become-pass

check: install_ansible install_yay
	$(PLAYBOOK) --check $(FLAGS) $(INVENTORY) localhost.yml
install: install_ansible
	$(PLAYBOOK) $(FLAGS) $(INVENTORY) localhost.yml
vagrant: install_ansible
	@grep -q '^vagrant:' /etc/passwd && ($(PLAYBOOK) $(INVENTORY) localhost.yml || 1) || echo -e "\e[31mNope, you are not on Vagrant\e[0m"
install_ansible: update_cache
	yes | LC_ALL=en_US.UTF-8 sudo pacman -S $(ANSIBLE_PKG) --needed
install_yay: update_cache install_utilities
	rm -rf yay
	git clone https://aur.archlinux.org/yay.git
	cd yay && yes | LC_ALL=en_US.UTF-8 makepkg -si
install_utilities: update_cache
	yes | LC_ALL=en_US.UTF-8 sudo pacman -S binutils gcc pkg-config fakeroot --needed
update_cache:
	yes | LC_ALL=en_US.UTF-8 sudo pacman -Sy
upgrade_packages: update_cache
	yes | LC_ALL=en_US.UTF-8 sudo pacman -Syu
clean_packages:
	yes | LC_ALL=en_US.UTF-8 sudo pacman -Rs $$(pacman -Qdttq)
	sudo paccache -rk 1
