- name: make sure php is installed
  package:
    name: php
    state: present
  become: yes

- name: symlink php.ini
  file:
    src: "{{ ansible_env.PWD }}/roles/php/files/php.ini"
    path: /etc/php/php.ini
    state: link
    follow: false
    force: yes

 - name: make sure composer is installed
  package:
    name: composer
    state: present
  become: yes

- name: download php-pear for pecl
  git:
    repo: https://aur.archlinux.org/php-pear.git
    dest: ~/workspace/php-pear

- name: check if php-pear was downloaded
  stat:
    path: ~/workspace/php-pear
  register: php-pear

- name: install php-pear for pecl
  command: makepkg -si --noconfirm
  args:
    chdir: ~/workspace/php-pear
  when: php-pear.stat.exists